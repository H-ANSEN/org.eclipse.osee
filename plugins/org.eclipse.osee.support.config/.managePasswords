#!/bin/bash

#logFile="$HOME/.managePasswords.log"
#echo "first arg $0" 1>"$logFile"
#echo "second arg $1" 1>>"$logFile"

inputDialog="$HOME/inputDialog.tcl"
passFile="$HOME/.gitPwdData"

originUrl=`git config --get remote.origin.url`

getPassword() {

	#echo "File: $passFile" 1>>"$logFile"
	if [ -e "$passFile" ]
	then
	  #   echo "Password File - Found" 1>>"$logFile"
	  password=`git config --file "$passFile" --get remote."$originUrl".password`   
	  #   echo "From file: $password" 1>>"$logFile"
	else 
	  #   echo "Password File - Not Found" 1>>"$logFile"
	  echo "#Git Passwords" 1>"$passFile"
	fi


	if [ -z "$password" ]
	then
	  #   echo "Password From File Null - [$password]" 1>>"$logFile" 
	  password=`wish.exe "$inputDialog" -- %*`
	fi


	#Save password in file
	if [ -n "$password" ]
	then
	  #   echo "Password Not Null - [$password]" 1>>"$logFile"  
	  git config --file "$passFile" remote."$originUrl".password ""$password""
	fi

	echo "$password"
}

changePassword(){

	if [ ! -e "$passFile" ]
	then
	  echo "#Git Passwords" 1>"$passFile"
	fi

	new_password=`wish.exe "$inputDialog" -- %*`
	
	if [ -n "$new_password" ]
	then
	    git config --file "$passFile" remote."$originUrl".password ""$new_password""
	fi
}


case "$1" in
  update)
    changePassword
    ;;
  *)
    getPassword
    exit 0
esac